name: Tests (Simple)

on:
  pull_request:
    branches:
      - main
      - master
  push:
    branches:
      - main
      - master
  workflow_dispatch:

jobs:
  django-check:
    name: Django System Check
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ”„ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ Set up Python 3.11
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: ğŸ“¦ Install dependencies
      run: |
        cd Django
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: âœ… Run Django checks
      run: |
        cd Django
        python manage.py check --deploy
      env:
        DJANGO_SETTINGS_MODULE: 'health_assistant.settings'
        DEBUG: 'False'
        SECRET_KEY: 'test-secret-key-for-ci-checks'
        USE_POSTGRESQL: 'False'
        
  validate-ml:
    name: Validate ML Assets
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ”„ Checkout code
      uses: actions/checkout@v4
      
    - name: âœ… Check ML model exists
      run: |
        if [ -f "ML/models/disease_predictor_v2.pkl" ]; then
          echo "âœ… ML model found"
          ls -lh ML/models/disease_predictor_v2.pkl
        else
          echo "âš ï¸ ML model not found"
          echo "Run: cd ML/scripts && python train_model_realistic.py"
          exit 1
        fi
        
    - name: âœ… Check datasets exist
      run: |
        echo "Checking required datasets..."
        
        datasets=(
          "ML/Datasets/active/train.csv"
          "ML/Datasets/active/test.csv"
          "ML/Datasets/active/symptom_Description.csv"
          "ML/Datasets/active/symptom_precaution.csv"
          "ML/Datasets/active/Symptom-severity.csv"
        )
        
        all_present=true
        
        for dataset in "${datasets[@]}"; do
          if [ -f "$dataset" ]; then
            echo "âœ… $dataset"
          else
            echo "âŒ $dataset missing!"
            all_present=false
          fi
        done
        
        if [ "$all_present" = false ]; then
          exit 1
        fi
        
        echo ""
        echo "âœ… All datasets present"
